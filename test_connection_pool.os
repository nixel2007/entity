// Простой тест для проверки работы пула соединений

#Использовать "src"

Процедура ТестПулаСоединений()
	
	Попытка
		ПулСоединений = Новый ПулСоединений(2, Тип("КоннекторInMemory"), "test", Новый Массив);
		Сообщить("ПулСоединений создан успешно");
		
		Соединение1 = ПулСоединений.ПолучитьСоединение();
		Сообщить("Соединение 1 получено из пула");
		
		Соединение2 = ПулСоединений.ПолучитьСоединение();  
		Сообщить("Соединение 2 получено из пула");
		
		// Проверяем, что это разные соединения
		Коннектор1 = Соединение1.ПолучитьКоннектор();
		Коннектор2 = Соединение2.ПолучитьКоннектор();
		
		Если Коннектор1 <> Коннектор2 Тогда
			Сообщить("Соединения используют разные коннекторы - ОК");
		Иначе
			Сообщить("ОШИБКА: Соединения используют один коннектор!");
		КонецЕсли;
		
		// Возвращаем соединения в пул
		ПулСоединений.ВернутьСоединение(Соединение1);
		ПулСоединений.ВернутьСоединение(Соединение2);
		Сообщить("Соединения возвращены в пул");
		
		// Проверяем переиспользование соединений
		Соединение3 = ПулСоединений.ПолучитьСоединение();
		Сообщить("Соединение 3 получено из пула (переиспользование)");
		
		ПулСоединений.ВернутьСоединение(Соединение3);
		
		Сообщить("ТЕСТ ПУЛА СОЕДИНЕНИЙ ПРОЙДЕН УСПЕШНО!");
		
	Исключение
		Сообщить("ОШИБКА ТЕСТА: " + ОписаниеОшибки());
	КонецПопытки;
	
КонецПроцедуры

Процедура ТестМенеджераСущностей()
	
	Попытка
		МенеджерСущностей = Новый МенеджерСущностей(Тип("КоннекторInMemory"), "test", Неопределено, 3);
		Сообщить("МенеджерСущностей создан с пулом размером 3");
		
		МенеджерСущностей.Инициализировать();
		Сообщить("МенеджерСущностей инициализирован");
		
		// Проверяем получение соединения
		Соединение = МенеджерСущностей.ПолучитьСоединение();
		Сообщить("Соединение получено из менеджера");
		
		// Возвращаем соединение
		МенеджерСущностей.ВернутьСоединение(Соединение);
		Сообщить("Соединение возвращено в менеджер");
		
		МенеджерСущностей.Закрыть();
		Сообщить("МенеджерСущностей закрыт");
		
		Сообщить("ТЕСТ МЕНЕДЖЕРА СУЩНОСТЕЙ ПРОЙДЕН УСПЕШНО!");
		
	Исключение
		Сообщить("ОШИБКА ТЕСТА: " + ОписаниеОшибки());
	КонецПопытки;
	
КонецПроцедуры

ТестПулаСоединений();
Сообщить("");
ТестМенеджераСущностей();